# https://www.rstudio.com/resources/videos/using-web-apis-from-r/
# video montrant l utilite 

# chargement de librairies
require.library(httr)
library(httr)
library(jsonlite)

# necessite de connaitre la doc de l ap
# recuperer les contact des mairies a partir de l API
mairie21 <-GET('http://etablissements-publics.api.gouv.fr/v1/organismes/21/mairie')

# il faut parser pour obtenir qqchose d exploitable
# creation fonction parse
json_parse <- function(req) {
  text <- content(req, as='text', encoding="UTF-8")
    if(identical(text, "")) warn("No output to parse")
  fromJSON(text, simplifyDataFrame = TRUE, flatten = TRUE)
}

# ==== 02 applatissement de json ====
df_mairie21 <- jsonlite::flatten( as.data.frame(json_parse(mairie21)))
df_mairie25 <- jsonlite::flatten( as.data.frame(json_parse(mairie25)))
df_mairie39 <- jsonlite::flatten( as.data.frame(json_parse(mairie39)))
df_mairie58 <- jsonlite::flatten( as.data.frame(json_parse(mairie58)))
df_mairie70 <- jsonlite::flatten( as.data.frame(json_parse(mairie70)))
df_mairie71 <- jsonlite::flatten( as.data.frame(json_parse(mairie71)))
df_mairie89 <- jsonlite::flatten( as.data.frame(json_parse(mairie89)))
df_mairie90 <- jsonlite::flatten( as.data.frame(json_parse(mairie90)))
